<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stoisko z lemoniadą</title>
<style>
body{font-family:Arial;text-align:center;margin:20px;}
button{margin:5px;padding:5px 10px;}
#paragon{border:1px solid black; display:inline-block; padding:10px; margin-top:10px; text-align:center; min-width:250px;}
#produktyDiv{margin:10px;}

/* Okienko admina na środku */
#adminLoginBox{
    display:none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background:white;
    border:2px solid black;
    padding:20px;
    z-index:1000;
    min-width:250px;
    box-shadow:0px 0px 10px rgba(0,0,0,0.5);
}
#adminButtons{
    text-align:right;
    margin-top:10px;
}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

</head>
<body>

<div id="loginDiv">
<h2>Logowanie</h2>
Login: <input id="loginUser" placeholder="Login">
Hasło: <input id="passUser" type="password" placeholder="Hasło">
<button onclick="logowanie()">Zaloguj</button>
<p id="loginError" style="color:red"></p>
</div>

<div id="appDiv" style="display:none;">
<h1>Stoisko z lemoniadą</h1>

<div id="produktyDiv">
<div>Lem. bez soku: <span id="bezSoku">0</span> <button onclick="zmienIlosc('bezSoku',1)">+</button> <button onclick="zmienIlosc('bezSoku',-1)">-</button></div>
<div>Lem. z sokiem: <span id="zSokiem">0</span> <button onclick="zmienIlosc('zSokiem',1)">+</button> <button onclick="zmienIlosc('zSokiem',-1)">-</button></div>
</div>

<div>
<button onclick="generujParagon()">Generuj paragon</button>
<button onclick="pobierzParagon()">Pobierz paragon jako obraz</button>
<button onclick="adminActionPrompt('dodaj')">Dodaj zarobek (admin)</button>
<button onclick="adminActionPrompt('odejmij')">Odejmij zarobek (admin)</button>
<button onclick="adminActionPrompt('wyzeruj')">Wyzeruj zarobek (admin)</button>
</div>

<h3>Wartość zakupu: <span id="wartoscZakupu">0</span> zł</h3>
<div id="paragon"></div>
<h3 id="zarobekTekst">Zarobek z dzisiaj: 0 | Zarobek łącznie: 0</h3>
</div>

<!-- Okienko logowania admina -->
<div id="adminLoginBox">
<h3>Logowanie admina</h3>
Login: <input id="adminLogin" placeholder="Login"><br>
Hasło: <input id="adminPass" type="password" placeholder="Hasło"><br>
Kwota (tylko dla dodaj/odejmij): <input id="adminKwota" placeholder="Kwota"><br>
<div id="adminButtons">
<button onclick="zatwierdzAdminLogin()">Zatwierdź</button>
<button onclick="anulujAdmin()">Anuluj</button>
</div>
<p id="adminError" style="color:red"></p>
</div>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "TWOJE_APIKEY",
  authDomain: "TWOJ_PROJEKT.firebaseapp.com",
  databaseURL: "https://TWOJ_PROJEKT-default-rtdb.firebaseio.com",
  projectId: "TWOJ_PROJEKT",
  storageBucket: "TWOJ_PROJEKT.appspot.com",
  messagingSenderId: "NUMER",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Produkty
let produkty = {bezSoku:{ilosc:0,cena:2.5}, zSokiem:{ilosc:0,cena:3}};
let sumaZakupu = 0;

// Zarobek
let zarobekDzis = 0;
let zarobekCalk = 0;
let currentAdminAction='';

// Odczyt z Firebase
db.ref('zarobekDzis').on('value',snap=>{if(snap.exists()){zarobekDzis=snap.val();aktualizujZarobek();}});
db.ref('zarobekCalk').on('value',snap=>{if(snap.exists()){zarobekCalk=snap.val();aktualizujZarobek();}});

// Funkcje
function aktualizujWartoscZakupu(){
    sumaZakupu = produkty.bezSoku.ilosc*produkty.bezSoku.cena + produkty.zSokiem.ilosc*produkty.zSokiem.cena;
    document.getElementById('wartoscZakupu').innerText = sumaZakupu.toFixed(2);
}

function zmienIlosc(prod,delta){
    produkty[prod].ilosc += delta;
    if(produkty[prod].ilosc<0) produkty[prod].ilosc=0;
    document.getElementById(prod).innerText = produkty[prod].ilosc;
    aktualizujWartoscZakupu();
}

function aktualizujParagon(){
    let text='';
    if(produkty.bezSoku.ilosc>0) text+=`Lem. bez soku x ${produkty.bezSoku.ilosc} = ${(produkty.bezSoku.ilosc*produkty.bezSoku.cena).toFixed(2)} zł\n`;
    if(produkty.zSokiem.ilosc>0) text+=`Lem. z sokiem x ${produkty.zSokiem.ilosc} = ${(produkty.zSokiem.ilosc*produkty.zSokiem.cena).toFixed(2)} zł\n`;
    text+=`Razem: ${sumaZakupu.toFixed(2)} zł\nDziękujemy za zakupy!`;
    document.getElementById('paragon').innerText=text;
}

function aktualizujZarobek(){
    document.getElementById('zarobekTekst').innerText=`Zarobek z dzisiaj: ${zarobekDzis.toFixed(2)} | Zarobek łącznie: ${zarobekCalk.toFixed(2)}`;
}

function generujParagon(){
    aktualizujParagon();
    zarobekDzis += sumaZakupu;
    zarobekCalk += sumaZakupu;
    db.ref('zarobekDzis').set(zarobekDzis);
    db.ref('zarobekCalk').set(zarobekCalk);
    aktualizujZarobek();

    // Zerowanie liczników
    for(let p in produkty){
        produkty[p].ilosc=0;
        document.getElementById(p).innerText=0;
    }
    sumaZakupu=0;
    aktualizujWartoscZakupu();
    alert('Paragon wygenerowany i liczniki zresetowane!');
}

function pobierzParagon(){
    html2canvas(document.getElementById('paragon')).then(canvas=>{
        let link=document.createElement('a');
        link.download='paragon.png';
        link.href=canvas.toDataURL();
        link.click();
    });
}

function logowanie(){
    const l=document.getElementById('loginUser').value;
    const p=document.getElementById('passUser').value;
    if(l==='stoisko' && p==='lemoniada123'){
        document.getElementById('loginDiv').style.display='none';
        document.getElementById('appDiv').style.display='block';
    }
    else{document.getElementById('loginError').innerText='Błędny login lub hasło!';}
}

// Admin
function adminActionPrompt(action){
    currentAdminAction=action;
    document.getElementById('adminLoginBox').style.display='block';
    document.getElementById('adminError').innerText='';
}

function zatwierdzAdminLogin(){
    const l=document.getElementById('adminLogin').value;
    const p=document.getElementById('adminPass').value;
    const kw=parseFloat(document.getElementById('adminKwota').value)||0;
    if(l==='admin' && p==='admin123'){
        if(currentAdminAction==='dodaj'){zarobekDzis+=kw; zarobekCalk+=kw;}
        else if(currentAdminAction==='odejmij'){zarobekDzis-=kw; zarobekCalk-=kw;if(zarobekDzis<0)zarobekDzis=0;if(zarobekCalk<0)zarobekCalk=0;}
        else if(currentAdminAction==='wyzeruj'){zarobekDzis=0; zarobekCalk=0;}
        db.ref('zarobekDzis').set(zarobekDzis);
        db.ref('zarobekCalk').set(zarobekCalk);
        aktualizujZarobek();
        document.getElementById('adminLoginBox').style.display='none';
        document.getElementById('adminLogin').value='';
        document.getElementById('adminPass').value='';
        document.getElementById('adminKwota').value='';
    } else {document.getElementById('adminError').innerText='Błędny login lub hasło!';}
}

function anulujAdmin(){
    document.getElementById('adminLoginBox').style.display='none';
    document.getElementById('adminLogin').value='';
    document.getElementById('adminPass').value='';
    document.getElementById('adminKwota').value='';
}
</script>
</body>
</html>
