<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Stoisko z lemoniadą</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffffff">
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body{font-family:Arial;text-align:center;margin:20px;}
button{margin:5px;padding:10px 15px;font-size:14px;}
#paragon{border:1px solid #000;display:inline-block;padding:10px;margin-top:10px;min-width:250px;text-align:center;}
#produktyDiv{margin:10px;}
#adminPanel, #loginAdminPanel{display:none;}
</style>
</head>
<body>
<h2>Logowanie</h2>
<div id="loginDiv">
<input id="loginUser" placeholder="Login">
<input id="passUser" placeholder="Hasło" type="password">
<button onclick="logowanie()">Zaloguj</button>
<p id="loginError" style="color:red;"></p>
</div>

<div id="appDiv" style="display:none;">
<h2>Stoisko z lemoniadą</h2>
<div id="produktyDiv">
<div>Lem. bez soku: <span id="bezSoku">0</span> <button onclick="zmienIlosc('bezSoku',1)">+</button> <button onclick="zmienIlosc('bezSoku',-1)">-</button></div>
<div>Lem. z sokiem: <span id="zSokiem">0</span> <button onclick="zmienIlosc('zSokiem',1)">+</button> <button onclick="zmienIlosc('zSokiem',-1)">-</button></div>
</div>

<button onclick="generujParagon()">Generuj paragon</button>
<button onclick="pobierzParagon()">Pobierz paragon jako obraz</button>
<button onclick="adminLoginPrompt('dodaj')">Dodaj zarobek (admin)</button>
<button onclick="adminLoginPrompt('odejmij')">Odejmij zarobek (admin)</button>
<button onclick="adminLoginPrompt('wyzeruj')">Wyzeruj zarobek (admin)</button>

<h3>Wartość zakupu: <span id="wartoscZakupu">0</span> zł</h3>
<div>Paragon:</div>
<div id="paragon"></div>
<h3 id="zarobekTekst">Zarobek z dzisiaj: 0 | Zarobek łącznie: 0</h3>
</div>

<!-- Admin Panel -->
<div id="loginAdminPanel">
<h3>Login admina</h3>
<input id="adminLogin" placeholder="Login">
<input id="adminPass" placeholder="Hasło" type="password">
<button onclick="zatwierdzAdminLogin()">Zaloguj</button>
<p id="loginAdminError" style="color:red;"></p>
</div>

<div id="adminPanel">
<h3 id="adminActionTxt"></h3>
<input id="adminKwota" placeholder="Ile zł">
<button onclick="zatwierdzAdminAction()">Zatwierdź</button>
<button onclick="anulujAdminAction()">Anuluj</button>
</div>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
// KONFIGURACJA FIREBASE
const firebaseConfig = {
  apiKey: "TWOJE_APIKEY",
  authDomain: "TWOJ_PROJEKT.firebaseapp.com",
  databaseURL: "https://TWOJ_PROJEKT-default-rtdb.firebaseio.com",
  projectId: "TWOJ_PROJEKT",
  storageBucket: "TWOJ_PROJEKT.appspot.com",
  messagingSenderId: "NUMER",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// PRODUKTY
let produkty = {bezSoku:{ilosc:0,cena:2.50}, zSokiem:{ilosc:0,cena:3}};
let sumaZakupu = 0;

// ZAROBEK
let zarobekDzis = 0;
let zarobekCalk = 0;
let currentAdminAction='';

// ODCZYT Z FIREBASE
db.ref('zarobekDzis').on('value', snap => { if(snap.exists()){ zarobekDzis=snap.val(); aktualizujZarobek(); } });
db.ref('zarobekCalk').on('value', snap => { if(snap.exists()){ zarobekCalk=snap.val(); aktualizujZarobek(); } });

// FUNKCJE
function aktualizujWartoscZakupu(){
    sumaZakupu = produkty.bezSoku.ilosc*produkty.bezSoku.cena + produkty.zSokiem.ilosc*produkty.zSokiem.cena;
    document.getElementById('wartoscZakupu').innerText = sumaZakupu.toFixed(2);
}

function zmienIlosc(prod,delta){
    produkty[prod].ilosc += delta;
    if(produkty[prod].ilosc<0) produkty[prod].ilosc=0;
    document.getElementById(prod).innerText=produkty[prod].ilosc;
    aktualizujWartoscZakupu();
}

function aktualizujParagon(){
    let text = '';
    if(produkty.bezSoku.ilosc>0) text+=`Lem. bez soku: ${produkty.bezSoku.ilosc} x ${produkty.bezSoku.cena} zł\n`;
    if(produkty.zSokiem.ilosc>0) text+=`Lem. z sokiem: ${produkty.zSokiem.ilosc} x ${produkty.zSokiem.cena} zł\n`;
    text+=`Suma: ${sumaZakupu.toFixed(2)} zł`;
    document.getElementById('paragon').innerText=text;
}

function aktualizujZarobek(){
    document.getElementById('zarobekTekst').innerText = `Zarobek z dzisiaj: ${zarobekDzis.toFixed(2)} | Zarobek łącznie: ${zarobekCalk.toFixed(2)}`;
}

function generujParagon(){
    aktualizujParagon();
    zarobekDzis += sumaZakupu;
    zarobekCalk += sumaZakupu;
    db.ref('zarobekDzis').set(zarobekDzis);
    db.ref('zarobekCalk').set(zarobekCalk);
    aktualizujZarobek();

    // RESET LICZNIKÓW PRODUKTÓW
    for(let p in produkty){
        produkty[p].ilosc = 0;
        document.getElementById(p).innerText=0;
    }
    sumaZakupu = 0;
    aktualizujWartoscZakupu();
    alert('Paragon wygenerowany, liczniki zresetowane i zarobek zapisany!');
}

function pobierzParagon(){
    html2canvas(document.getElementById('paragon')).then(canvas=>{
        let link = document.createElement('a');
        link.download='paragon.png';
        link.href = canvas.toDataURL();
        link.click();
    });
}

function logowanie(){
    const l=document.getElementById('loginUser').value;
    const p=document.getElementById('passUser').value;
    if((l==='stoisko' && p==='lemoniada123')||(l==='admin' && p==='admin123')){
        document.getElementById('loginDiv').style.display='none';
        document.getElementById('appDiv').style.display='block';
    } else {
        document.getElementById('loginError').innerText='Błędny login lub hasło!';
    }
}

// ADMIN
function adminLoginPrompt(action){
    currentAdminAction = action;
    document.getElementById('loginAdminPanel').style.display='block';
    document.getElementById('adminActionTxt').innerText = action==='dodaj'?'Dodaj zarobek':action==='odejmij'?'Odejmij zarobek':'Wyzeruj zarobek';
}

function zatwierdzAdminLogin(){
    const login=document.getElementById('adminLogin').value;
    const pass=document.getElementById('adminPass').value;
    if(login==='admin' && pass==='admin123'){
        document.getElementById('loginAdminPanel').style.display='none';
        document.getElementById('adminPanel').style.display='block';
    } else {
        document.getElementById('loginAdminError').innerText='Błędny login lub hasło!';
    }
}

function zatwierdzAdminAction(){
    const kw=parseFloat(document.getElementById('adminKwota').value) || 0;
    if(currentAdminAction==='dodaj'){ zarobekDzis+=kw; zarobekCalk+=kw; }
    else if(currentAdminAction==='odejmij'){ zarobekDzis-=kw; zarobekCalk-=kw; if(zarobekDzis<0) zarobekDzis=0; if(zarobekCalk<0) zarobekCalk=0; }
    else if(currentAdminAction==='wyzeruj'){ zarobekDzis=0; zarobekCalk=0; }
    db.ref('zarobekDzis').set(zarobekDzis);
    db.ref('zarobekCalk').set(zarobekCalk);
    aktualizujZarobek();
    document.getElementById('adminPanel').style.display='none';
    document.getElementById('adminKwota').value='';
}

function anulujAdminAction(){
    document.getElementById('adminPanel').style.display='none';
    document.getElementById('adminKwota').value='';
}
</script>
</body>
</html>
